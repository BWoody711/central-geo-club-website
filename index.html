<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central Geo Club Multimedia Database</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>

    </style>
    <script>
        const API_KEY = 'AIzaSyCq2h0vwfY-RR_bJ5NOhvxn0cNVTcMaqPo'
        const SPREADSHEET_ID = '1M0jmUV4XPYEFe3SeM-sHyBhWiY9ApA4cTu8GsN9lGvg';
        const SHEET_NAME = 'CentralGeoClubArchiveComplete';

        //Reload everything once window size changes
        let posts;

        async function fetchData() {
            const res = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`)
            const data = await res.json()
            return data;
        }

        function postData(data) {
            const container = document.getElementById('container');
            container.innerHTML = ''; // Clear previous data
            data.slice(0,50).forEach(row => {
                if (row[0] !== "ID") {
                    const card = document.createElement('div');
                    card.style = "align-self: center; justify-content: center;"
                    card.className="card"
                    const cardTitle = document.createElement('h5')
                    cardTitle.className="card-title"
                    cardTitle.style = "display: flex; justify-self: center; align-self: center; width: 100%; font-size: 3vh; margin: 0; padding-bottom: 1vh"
                    cardTitle.textContent = row[4]==="PNG" || row[4]==="JPG" ? "Image" : row[7] ? row[7].includes('https://youtu.be/') ? "Video" : "Article" : "Article"
                    const cardBody = document.createElement('div');
                    cardBody.className="card-body"
                    cardBody.style = "justify-content: center; align-items: center; padding: 1.25vh;"
                    cardBody.appendChild(cardTitle)
                    if (row[4]==="PNG" || row[4]==="JPG") {
                        const img = document.createElement('img')
                        img.className="card-img-top"
                        img.src = "./images/" + row[0] + "." + row[4].toLowerCase()
                        img.style = "max-width: 70vw;"
                        cardBody.appendChild(img)
                        
                    }
                    else if (row[7]) {
                        if(row[7].includes('https://youtu.be/')) {
                            const iframe = document.createElement('iframe')
                            iframe.src = "https://www.youtube.com/embed/" + row[7].split("youtu.be/")[1]
                            iframe.width = (window.innerWidth*0.55).toString() + "px"
                            iframe.height = (window.innerWidth*0.55*(9/16)).toString() + "px"
                            cardBody.appendChild(iframe)
                        }
                        else {
                            const article = document.createElement('article')
                            const a = document.createElement('a')
                            a.classList.add("btn", "btn-primary")
                            a.textContent = "Read Article"
                            a.target = "_blank"
                            a.href = row[7]
                            article.appendChild(a)
                            cardBody.appendChild(article)
                        }
                    }
                    const p = document.createElement('p')
                    p.className = "card-text"
                    p.textContent = row[5] ? row[5] : "" + row[6] ? row [5] ? "\n\n" + row[6] : row[6] : "" + row[8] ? row[5] || row[6] ? "\n\n" + row[8] : row[8] : ""
                    cardBody.appendChild(p)
                    card.appendChild(cardBody)
                    const cardFooter = document.createElement('div');
                    cardFooter.className = "card-footer"
                    const a = document.createElement('a');
                    a.classList.add("btn", "btn-primary")
                    a.href = row[1]
                    a.textContent = "View Original Post"
                    a.target = "_blank"
                    cardFooter.appendChild(a)
                    card.appendChild(cardFooter)
                    container.appendChild(card)
                }
            })
        }

        function searchPosts(e) {
            if(e.target.value.length > 2) {
                const selectedPosts = posts.filter(function (i,n){
                    if(i[12]) {
                        if(i[12].includes(e.target.value)) {
                            return i
                        }
                    }
                });
                postData(selectedPosts)
            }
            else {
                postData(posts)
            }
        }

        function loader() {
            fetchData().then((data) => {
                console.log(data.values.length)
                posts = data.values;
                postData(data.values)
            })
            document.getElementById("search").addEventListener("input", searchPosts)
        }

        window.onload = loader;
    </script>
</head>
<body>
    <h2 style="height: 9vh; display: flex; justify-content: left; align-items: center; padding-left: 2vh; padding-right: 2vh; margin: 0;">Central Geo Club Multimedia Database</h2>
    <div id="outer-container" style="top: 9vh; display: grid; grid-template-columns: 25% 75%; grid-template-rows: auto; gap: 0.5vh; height: 85vh; width: 100%; padding-left: 0vh; padding-right: 0vh; overflow-x: hidden; overflow-y: hidden;">
        <div id="filters" style="height: 100%; width: 100%; padding-left: 2vh; padding-right: 2vh">
            <h5>Filter Results</h5>
            <br />
            <input id="search" type="search" placeholder="Keyword search..."/>
            <br />
            <br />
            <select name="media-type">
                <option value="all">All</option>
                <option value="images">Images</option>
                <option value="videos">Videos</option>
                <option value="articles">Articles</option>
            </select>
        </div>
        <div id="container" style="display: grid; grid-template-columns: auto; grid-template-rows: auto auto auto auto; gap: 0.5vh; height: 100%; width: 100%; padding-left: 10vw; padding-right: 10vw; padding-top: 4vh; padding-bottom: 4vh; overflow-y: scroll;">
        
        </div>
    </div>
    <footer style="display: grid; grid-template-columns: 60% 40%; height: 6vh; background-color: white; width: 100%;">
        <p style="margin: 0; display: flex; align-self: center; justify-self: right; padding-right: 2%;">For educational purposes only. All content is the property of the original authors.</p><p style="margin: 0; display: flex; align-self: center; justify-self: left; padding-left: 2%;">Website created by Ben Woodward in 2024</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>